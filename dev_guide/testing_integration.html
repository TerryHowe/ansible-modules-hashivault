

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Integration tests &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/dev_guide/testing_integration.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="2.9">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.9
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible for Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Ansible for Network Automation</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Integration tests</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/dev_guide/testing_integration.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="integration-tests">
<span id="testing-integration"></span><h1><a class="toc-backref" href="#id1">Integration tests</a><a class="headerlink" href="#integration-tests" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#integration-tests" id="id1">Integration tests</a></p>
<ul>
<li><p><a class="reference internal" href="#quick-start" id="id2">Quick Start</a></p></li>
<li><p><a class="reference internal" href="#configuration" id="id3">Configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#ansible-test-command" id="id4">ansible-test command</a></p></li>
<li><p><a class="reference internal" href="#integration-config-yml" id="id5">integration_config.yml</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#prerequisites" id="id6">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#non-destructive-tests" id="id7">Non-destructive Tests</a></p></li>
<li><p><a class="reference internal" href="#destructive-tests" id="id8">Destructive Tests</a></p></li>
<li><p><a class="reference internal" href="#windows-tests" id="id9">Windows Tests</a></p></li>
<li><p><a class="reference internal" href="#tests-in-docker-containers" id="id10">Tests in Docker containers</a></p>
<ul>
<li><p><a class="reference internal" href="#running-integration-tests" id="id11">Running Integration Tests</a></p></li>
<li><p><a class="reference internal" href="#container-images" id="id12">Container Images</a></p>
<ul>
<li><p><a class="reference internal" href="#python-2" id="id13">Python 2</a></p></li>
<li><p><a class="reference internal" href="#python-3" id="id14">Python 3</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#legacy-cloud-tests" id="id15">Legacy Cloud Tests</a></p></li>
<li><p><a class="reference internal" href="#other-configuration-for-cloud-tests" id="id16">Other configuration for Cloud Tests</a></p></li>
<li><p><a class="reference internal" href="#iam-policies-for-aws" id="id17">IAM policies for AWS</a></p>
<ul>
<li><p><a class="reference internal" href="#testing-policies" id="id18">testing-policies</a></p></li>
<li><p><a class="reference internal" href="#other-definitions-required" id="id19">Other Definitions required</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#network-tests" id="id20">Network Tests</a></p>
<ul>
<li><p><a class="reference internal" href="#writing-network-integration-tests" id="id21">Writing network integration tests</a></p></li>
<li><p><a class="reference internal" href="#running-network-integration-tests-locally" id="id22">Running network integration tests locally</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#where-to-find-out-more" id="id23">Where to find out more</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The Ansible integration Test system.</p>
<p>Tests for playbooks, by playbooks.</p>
<p>Some tests may require credentials.  Credentials may be specified with <cite>credentials.yml</cite>.</p>
<p>Some tests may require root.</p>
<div class="section" id="quick-start">
<h2><a class="toc-backref" href="#id2">Quick Start</a><a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>It is highly recommended that you install and activate the <code class="docutils literal notranslate"><span class="pre">argcomplete</span></code> python package.
It provides tab completion in <code class="docutils literal notranslate"><span class="pre">bash</span></code> for the <code class="docutils literal notranslate"><span class="pre">ansible-test</span></code> test runner.</p>
</div>
<div class="section" id="configuration">
<h2><a class="toc-backref" href="#id3">Configuration</a><a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ansible-test-command">
<h3><a class="toc-backref" href="#id4">ansible-test command</a><a class="headerlink" href="#ansible-test-command" title="Permalink to this headline">¶</a></h3>
<p>The example below assumes <code class="docutils literal notranslate"><span class="pre">bin/</span></code> is in your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>. An easy way to achieve that
is to initialize your environment with the <code class="docutils literal notranslate"><span class="pre">env-setup</span></code> command:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">source hacking/env-setup</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-test --help</span>
</pre></div>
</div>
<p>You can also call <code class="docutils literal notranslate"><span class="pre">ansible-test</span></code> with the full path:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">bin/ansible-test --help</span>
</pre></div>
</div>
</div>
<div class="section" id="integration-config-yml">
<h3><a class="toc-backref" href="#id5">integration_config.yml</a><a class="headerlink" href="#integration-config-yml" title="Permalink to this headline">¶</a></h3>
<p>Making your own version of <code class="docutils literal notranslate"><span class="pre">integration_config.yml</span></code> can allow for setting some
tunable parameters to help run the tests better in your environment.  Some
tests (e.g. cloud) will only run when access credentials are provided.  For more
information about supported credentials, refer to the various <code class="docutils literal notranslate"><span class="pre">cloud-config-*.template</span></code>
files in the <code class="docutils literal notranslate"><span class="pre">test/integration/</span></code> directory.</p>
</div>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id6">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Some tests assume things like hg, svn, and git are installed, and in path.  Some tests
(such as those for Amazon Web Services) need separate definitions, which will be covered
later in this document.</p>
<p>(Complete list pending)</p>
</div>
<div class="section" id="non-destructive-tests">
<h2><a class="toc-backref" href="#id7">Non-destructive Tests</a><a class="headerlink" href="#non-destructive-tests" title="Permalink to this headline">¶</a></h2>
<p>These tests will modify files in subdirectories, but will not do things that install or remove packages or things
outside of those test subdirectories.  They will also not reconfigure or bounce system services.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running integration tests within Docker</p>
<p>To protect your system from any potential changes caused by integration tests, and to ensure a sensible set of dependencies are available we recommend that you always run integration tests with the <code class="docutils literal notranslate"><span class="pre">--docker</span></code> option. See the <a class="reference external" href="https://github.com/ansible/ansible/blob/devel/test/lib/ansible_test/_data/completion/docker.txt">list of supported docker images</a> for options.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Avoiding pulling new Docker images</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">--docker-no-pull</span></code> option to avoid pulling the latest container image. This is required when using custom local images that are not available for download.</p>
</div>
<p>Run as follows for all POSIX platform tests executed by our CI system:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration --docker fedora29 -v shippable/</span>
</pre></div>
</div>
<p>You can target a specific tests as well, such as for individual modules:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration -v ping</span>
</pre></div>
</div>
<p>Use the following command to list all the available targets:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration --list-targets</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bash users</p>
<p>If you use <code class="docutils literal notranslate"><span class="pre">bash</span></code> with <code class="docutils literal notranslate"><span class="pre">argcomplete</span></code>, obtain a full list by doing: <code class="docutils literal notranslate"><span class="pre">ansible-test</span> <span class="pre">integration</span> <span class="pre">&lt;tab&gt;&lt;tab&gt;</span></code></p>
</div>
</div>
<div class="section" id="destructive-tests">
<h2><a class="toc-backref" href="#id8">Destructive Tests</a><a class="headerlink" href="#destructive-tests" title="Permalink to this headline">¶</a></h2>
<p>These tests are allowed to install and remove some trivial packages.  You will likely want to devote these
to a virtual environment, such as Docker.  They won’t reformat your filesystem:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration --docker fedora29 -v destructive/</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-tests">
<h2><a class="toc-backref" href="#id9">Windows Tests</a><a class="headerlink" href="#windows-tests" title="Permalink to this headline">¶</a></h2>
<p>These tests exercise the <code class="docutils literal notranslate"><span class="pre">winrm</span></code> connection plugin and Windows modules.  You’ll
need to define an inventory with a remote Windows 2008 or 2012 Server to use
for testing, and enable PowerShell Remoting to continue.</p>
<p>Running these tests may result in changes to your Windows host, so don’t run
them against a production/critical Windows environment.</p>
<p>Enable PowerShell Remoting (run on the Windows host via Remote Desktop):</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Enable-PSRemoting -Force</span>
</pre></div>
</div>
<p>Define Windows inventory:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cp inventory.winrm.template inventory.winrm</span>
<span class="l l-Scalar l-Scalar-Plain">${EDITOR:-vi} inventory.winrm</span>
</pre></div>
</div>
<p>Run the Windows tests executed by our CI system:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test windows-integration -v shippable/</span>
</pre></div>
</div>
</div>
<div class="section" id="tests-in-docker-containers">
<h2><a class="toc-backref" href="#id10">Tests in Docker containers</a><a class="headerlink" href="#tests-in-docker-containers" title="Permalink to this headline">¶</a></h2>
<p>If you have a Linux system with Docker installed, running integration tests using the same Docker containers used by
the Ansible continuous integration (CI) system is recommended.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Docker on non-Linux</p>
<p>Using Docker Engine to run Docker on a non-Linux host (such as macOS) is not recommended.
Some tests may fail, depending on the image used for testing.
Using the <code class="docutils literal notranslate"><span class="pre">--docker-privileged</span></code> option when running <code class="docutils literal notranslate"><span class="pre">integration</span></code> (not <code class="docutils literal notranslate"><span class="pre">network-integration</span></code> or <code class="docutils literal notranslate"><span class="pre">windows-integration</span></code>) may resolve the issue.</p>
</div>
<div class="section" id="running-integration-tests">
<h3><a class="toc-backref" href="#id11">Running Integration Tests</a><a class="headerlink" href="#running-integration-tests" title="Permalink to this headline">¶</a></h3>
<p>To run all CI integration test targets for POSIX platforms in a Ubuntu 16.04 container:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration --docker ubuntu1604 -v shippable/</span>
</pre></div>
</div>
<p>You can also run specific tests or select a different Linux distribution.
For example, to run tests for the <code class="docutils literal notranslate"><span class="pre">ping</span></code> module on a Ubuntu 14.04 container:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test integration -v ping --docker ubuntu1404</span>
</pre></div>
</div>
</div>
<div class="section" id="container-images">
<h3><a class="toc-backref" href="#id12">Container Images</a><a class="headerlink" href="#container-images" title="Permalink to this headline">¶</a></h3>
<div class="section" id="python-2">
<h4><a class="toc-backref" href="#id13">Python 2</a><a class="headerlink" href="#python-2" title="Permalink to this headline">¶</a></h4>
<p>Most container images are for testing with Python 2:</p>
<blockquote>
<div><ul class="simple">
<li><p>centos6</p></li>
<li><p>centos7</p></li>
<li><p>fedora28</p></li>
<li><p>opensuse15py2</p></li>
<li><p>ubuntu1404</p></li>
<li><p>ubuntu1604</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="python-3">
<h4><a class="toc-backref" href="#id14">Python 3</a><a class="headerlink" href="#python-3" title="Permalink to this headline">¶</a></h4>
<p>To test with Python 3 use the following images:</p>
<blockquote>
<div><ul class="simple">
<li><p>fedora29</p></li>
<li><p>opensuse15</p></li>
<li><p>ubuntu1604py3</p></li>
<li><p>ubuntu1804</p></li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="legacy-cloud-tests">
<h2><a class="toc-backref" href="#id15">Legacy Cloud Tests</a><a class="headerlink" href="#legacy-cloud-tests" title="Permalink to this headline">¶</a></h2>
<p>Some of the cloud tests run as normal integration tests, and others run as legacy tests; see the
<a class="reference internal" href="testing_integration_legacy.html#testing-integration-legacy"><span class="std std-ref">Testing using the Legacy Integration system</span></a> page for more information.</p>
</div>
<div class="section" id="other-configuration-for-cloud-tests">
<h2><a class="toc-backref" href="#id16">Other configuration for Cloud Tests</a><a class="headerlink" href="#other-configuration-for-cloud-tests" title="Permalink to this headline">¶</a></h2>
<p>In order to run some tests, you must provide access credentials in a file named
<code class="docutils literal notranslate"><span class="pre">cloud-config-aws.yml</span></code> or <code class="docutils literal notranslate"><span class="pre">cloud-config-cs.ini</span></code> in the test/integration
directory. Corresponding .template files are available for for syntax help.  The newer AWS
tests now use the file test/integration/cloud-config-aws.yml</p>
</div>
<div class="section" id="iam-policies-for-aws">
<h2><a class="toc-backref" href="#id17">IAM policies for AWS</a><a class="headerlink" href="#iam-policies-for-aws" title="Permalink to this headline">¶</a></h2>
<p>Ansible needs fairly wide ranging powers to run the tests in an AWS account.  This rights can be provided to a dedicated user. These need to be configured before running the test.</p>
<div class="section" id="testing-policies">
<h3><a class="toc-backref" href="#id18">testing-policies</a><a class="headerlink" href="#testing-policies" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">hacking/aws_config/testing_policies</span></code> contains a set of policies that are required for all existing AWS module tests.
The <code class="docutils literal notranslate"><span class="pre">hacking/aws_config/setup_iam.yml</span></code> playbook can be used to add all of those policies to an IAM group (using
<code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">iam_group=GROUP_NAME</span></code>. Once the group is created, you’ll need to create a user and make the user a member of the
group. The policies are designed to minimize the rights of that user.  Please note that while this policy does limit
the user to one region, this does not fully restrict the user (primarily due to the limitations of the Amazon ARN
notation). The user will still have wide privileges for viewing account definitions, and will also able to manage
some resources that are not related to testing (for example, AWS lambdas with different names).  Tests should not
be run in a primary production account in any case.</p>
</div>
<div class="section" id="other-definitions-required">
<h3><a class="toc-backref" href="#id19">Other Definitions required</a><a class="headerlink" href="#other-definitions-required" title="Permalink to this headline">¶</a></h3>
<p>Apart from installing the policy and giving it to the user identity running the tests, a
lambda role <cite>ansible_integration_tests</cite> has to be created which has lambda basic execution
privileges.</p>
</div>
</div>
<div class="section" id="network-tests">
<h2><a class="toc-backref" href="#id20">Network Tests</a><a class="headerlink" href="#network-tests" title="Permalink to this headline">¶</a></h2>
<p>Starting with Ansible 2.4, all network modules MUST include unit tests that cover all functionality. You must add unit tests for each new network module and for each added feature. Please submit the unit tests and the code in a single PR. Integration tests are also strongly encouraged.</p>
<div class="section" id="writing-network-integration-tests">
<h3><a class="toc-backref" href="#id21">Writing network integration tests</a><a class="headerlink" href="#writing-network-integration-tests" title="Permalink to this headline">¶</a></h3>
<p>For guidance on writing network test see the <a class="reference external" href="https://github.com/ansible/community/blob/master/group-network/network_test.rst">adding tests for Network modules guide</a>.</p>
</div>
<div class="section" id="running-network-integration-tests-locally">
<h3><a class="toc-backref" href="#id22">Running network integration tests locally</a><a class="headerlink" href="#running-network-integration-tests-locally" title="Permalink to this headline">¶</a></h3>
<p>Ansible uses Shippable to run an integration test suite on every PR, including new tests introduced by that PR. To find and fix problems in network modules, run the network integration test locally before you submit a PR.</p>
<p>To run the network integration tests, use a command in the form:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory /path/to/inventory tests_to_run</span>
</pre></div>
</div>
<p>First, define a network inventory file:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">cd test/integration</span>
<span class="l l-Scalar l-Scalar-Plain">cp inventory.network.template inventory.networking</span>
<span class="l l-Scalar l-Scalar-Plain">${EDITOR:-vi} inventory.networking</span>
<span class="l l-Scalar l-Scalar-Plain"># Add in machines for the platform(s) you wish to test</span>
</pre></div>
</div>
<p>To run all Network tests for a particular platform:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory  /path/to/ansible/test/integration/inventory.networking vyos_.*</span>
</pre></div>
</div>
<p>This example will run against all vyos modules. Note that <code class="docutils literal notranslate"><span class="pre">vyos_.*</span></code> is a regex match, not a bash wildcard - include the <cite>.</cite> if you modify this example.</p>
<p>To run integration tests for a specific module:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory  /path/to/ansible/test/integration/inventory.networking vyos_vlan</span>
</pre></div>
</div>
<p>To run a single test case on a specific module:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only run vyos_vlan/tests/cli/basic.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory  /path/to/ansible/test/integration/inventory.networking vyos_vlan --testcase basic</span>
</pre></div>
</div>
<p>To run integration tests for a specific transport:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Only run nxapi test</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory  /path/to/ansible/test/integration/inventory.networking  --tags=&quot;nxapi&quot; nxos_.*</span>

<span class="l l-Scalar l-Scalar-Plain"># Skip any cli tests</span>
<span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --inventory  /path/to/ansible/test/integration/inventory.networking  --skip-tags=&quot;cli&quot; nxos_.*</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/ansible/ansible/blob/devel/test/integration/targets/nxos_bgp/tasks/main.yaml">test/integration/targets/nxos_bgp/tasks/main.yaml</a> for how this is implemented in the tests.</p>
<p>For more options:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-test network-integration --help</span>
</pre></div>
</div>
<p>If you need additional help or feedback, reach out in <code class="docutils literal notranslate"><span class="pre">#ansible-network</span></code> on Freenode.</p>
</div>
</div>
<div class="section" id="where-to-find-out-more">
<h2><a class="toc-backref" href="#id23">Where to find out more</a><a class="headerlink" href="#where-to-find-out-more" title="Permalink to this headline">¶</a></h2>
<p>If you’d like to know more about the plans for improving testing Ansible, join the <a class="reference external" href="https://github.com/ansible/community/blob/master/meetings/README.md">Testing Working Group</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on May 03, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>