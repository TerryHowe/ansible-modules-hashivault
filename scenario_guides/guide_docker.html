

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker Guide &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/scenario_guides/guide_docker.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Kubernetes and OpenShift Guide" href="guide_kubernetes.html" />
    <link rel="prev" title="Virtualization and Containerization Guides" href="virt_guides.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="2.9">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.9
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="virt_guides.html">Virtualization and Containerization Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Docker Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-the-docker-api">Connecting to the Docker API</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-inventory-script">Dynamic Inventory Script</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#groups">Groups</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="guide_kubernetes.html">Kubernetes and OpenShift Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vagrant.html">Vagrant Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="guide_vmware.html">VMware Guide</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Ansible for Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Ansible for Network Automation</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="virt_guides.html">Virtualization and Containerization Guides</a> &raquo;</li>
        
      <li>Docker Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/scenario_guides/guide_docker.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="docker-guide">
<h1>Docker Guide<a class="headerlink" href="#docker-guide" title="Permalink to this headline">¶</a></h1>
<p>Ansible offers the following modules for orchestrating Docker containers:</p>
<blockquote>
<div><dl class="simple">
<dt>docker_compose</dt><dd><p>Use your existing Docker compose files to orchestrate containers on a single Docker daemon or on
Swarm. Supports compose versions 1 and 2.</p>
</dd>
<dt>docker_container</dt><dd><p>Manages the container lifecycle by providing the ability to create, update, stop, start and destroy a
container.</p>
</dd>
<dt>docker_image</dt><dd><p>Provides full control over images, including: build, pull, push, tag and remove.</p>
</dd>
<dt>docker_image_info</dt><dd><p>Inspects one or more images in the Docker host’s image cache, providing the information for making
decision or assertions in a playbook.</p>
</dd>
<dt>docker_login</dt><dd><p>Authenticates with Docker Hub or any Docker registry and updates the Docker Engine config file, which
in turn provides password-free pushing and pulling of images to and from the registry.</p>
</dd>
<dt>docker (dynamic inventory)</dt><dd><p>Dynamically builds an inventory of all the available containers from a set of one or more Docker hosts.</p>
</dd>
</dl>
</div></blockquote>
<p>Ansible 2.1.0 includes major updates to the Docker modules, marking the start of a project to create a complete and
integrated set of tools for orchestrating containers. In addition to the above modules, we are also working on the
following:</p>
<p>Still using Dockerfile to build images? Check out <a class="reference external" href="https://github.com/ansible-community/ansible-bender">ansible-bender</a>,
and start building images from your Ansible playbooks.</p>
<p>Use <a class="reference external" href="https://learn.openshift.com/ansibleop/ansible-operator-overview/">Ansible Operator</a>
to launch your docker-compose file on <a class="reference external" href="https://www.okd.io/">OpenShift</a>. Go from an app on your laptop to a fully
scalable app in the cloud with Kubernetes in just a few moments.</p>
<p>There’s more planned. See the latest ideas and thinking at the <a class="reference external" href="https://github.com/ansible/proposals/tree/master/docker">Ansible proposal repo</a>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>Using the docker modules requires having the <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/">Docker SDK for Python</a>
installed on the host running Ansible. You will need to have &gt;= 1.7.0 installed. For Python 2.7 or
Python 3, you can install it as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install docker
</pre></div>
</div>
<p>For Python 2.6, you need a version before 2.0. For these versions, the SDK was called <code class="docutils literal notranslate"><span class="pre">docker-py</span></code>,
so you need to install it as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install <span class="s1">&#39;docker-py&gt;=1.7.0&#39;</span>
</pre></div>
</div>
<p>Please note that only one of <code class="docutils literal notranslate"><span class="pre">docker</span></code> and <code class="docutils literal notranslate"><span class="pre">docker-py</span></code> must be installed. Installing both will result in
a broken installation. If this happens, Ansible will detect it and inform you about it:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">Cannot have both the docker-py and docker python modules installed together as they use the same</span>
<span class="l l-Scalar l-Scalar-Plain">namespace and cause a corrupt installation. Please uninstall both packages, and re-install only</span>
<span class="l l-Scalar l-Scalar-Plain">the docker-py or docker python module. It is recommended to install the docker module if no support</span>
<span class="l l-Scalar l-Scalar-Plain">for Python 2.6 is required. Please note that simply uninstalling one of the modules can leave the</span>
<span class="l l-Scalar l-Scalar-Plain">other module in a broken state.</span>
</pre></div>
</div>
<p>The docker_compose module also requires <a class="reference external" href="https://github.com/docker/compose">docker-compose</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install <span class="s1">&#39;docker-compose&gt;=1.7.0&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="connecting-to-the-docker-api">
<h2>Connecting to the Docker API<a class="headerlink" href="#connecting-to-the-docker-api" title="Permalink to this headline">¶</a></h2>
<p>You can connect to a local or remote API using parameters passed to each task or by setting environment variables.
The order of precedence is command line parameters and then environment variables. If neither a command line
option or an environment variable is found, a default value will be used. The default values are provided under
<a class="reference internal" href="#parameters">Parameters</a></p>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>Control how modules connect to the Docker API by passing the following parameters:</p>
<blockquote>
<div><dl class="simple">
<dt>docker_host</dt><dd><p>The URL or Unix socket path used to connect to the Docker API. Defaults to <code class="docutils literal notranslate"><span class="pre">unix://var/run/docker.sock</span></code>.
To connect to a remote host, provide the TCP connection string. For example: <code class="docutils literal notranslate"><span class="pre">tcp://192.0.2.23:2376</span></code>. If
TLS is used to encrypt the connection to the API, then the module will automatically replace ‘tcp’ in the
connection URL with ‘https’.</p>
</dd>
<dt>api_version</dt><dd><p>The version of the Docker API running on the Docker Host. Defaults to the latest version of the API supported
by docker-py.</p>
</dd>
<dt>timeout</dt><dd><p>The maximum amount of time in seconds to wait on a response from the API. Defaults to 60 seconds.</p>
</dd>
<dt>tls</dt><dd><p>Secure the connection to the API by using TLS without verifying the authenticity of the Docker host server.
Defaults to False.</p>
</dd>
<dt>tls_verify</dt><dd><p>Secure the connection to the API by using TLS and verifying the authenticity of the Docker host server.
Default is False.</p>
</dd>
<dt>cacert_path</dt><dd><p>Use a CA certificate when performing server verification by providing the path to a CA certificate file.</p>
</dd>
<dt>cert_path</dt><dd><p>Path to the client’s TLS certificate file.</p>
</dd>
<dt>key_path</dt><dd><p>Path to the client’s TLS key file.</p>
</dd>
<dt>tls_hostname</dt><dd><p>When verifying the authenticity of the Docker Host server, provide the expected name of the server. Defaults
to ‘localhost’.</p>
</dd>
<dt>ssl_version</dt><dd><p>Provide a valid SSL version number. Default value determined by docker-py, which at the time of this writing
was 1.0</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="environment-variables">
<h3>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h3>
<p>Control how the modules connect to the Docker API by setting the following variables in the environment of the host
running Ansible:</p>
<blockquote>
<div><dl class="simple">
<dt>DOCKER_HOST</dt><dd><p>The URL or Unix socket path used to connect to the Docker API.</p>
</dd>
<dt>DOCKER_API_VERSION</dt><dd><p>The version of the Docker API running on the Docker Host. Defaults to the latest version of the API supported
by docker-py.</p>
</dd>
<dt>DOCKER_TIMEOUT</dt><dd><p>The maximum amount of time in seconds to wait on a response from the API.</p>
</dd>
<dt>DOCKER_CERT_PATH</dt><dd><p>Path to the directory containing the client certificate, client key and CA certificate.</p>
</dd>
<dt>DOCKER_SSL_VERSION</dt><dd><p>Provide a valid SSL version number.</p>
</dd>
<dt>DOCKER_TLS</dt><dd><p>Secure the connection to the API by using TLS without verifying the authenticity of the Docker Host.</p>
</dd>
<dt>DOCKER_TLS_VERIFY</dt><dd><p>Secure the connection to the API by using TLS and verify the authenticity of the Docker Host.</p>
</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="dynamic-inventory-script">
<h2>Dynamic Inventory Script<a class="headerlink" href="#dynamic-inventory-script" title="Permalink to this headline">¶</a></h2>
<p>The inventory script generates dynamic inventory by making API requests to one or more Docker APIs. It’s dynamic
because the inventory is generated at run-time rather than being read from a static file. The script generates the
inventory by connecting to one or many Docker APIs and inspecting the containers it finds at each API. Which APIs the
script contacts can be defined using environment variables or a configuration file.</p>
<div class="section" id="groups">
<h3>Groups<a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h3>
<p>The script will create the following host groups:</p>
<blockquote>
<div><ul class="simple">
<li><p>container id</p></li>
<li><p>container name</p></li>
<li><p>container short id</p></li>
<li><p>image_name  (image_&lt;image name&gt;)</p></li>
<li><p>docker_host</p></li>
<li><p>running</p></li>
<li><p>stopped</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>You can run the script interactively from the command line or pass it as the inventory to a playbook. Here are few
examples to get you started:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Connect to the Docker API on localhost port 4243 and format the JSON output</span>
<span class="nv">DOCKER_HOST</span><span class="o">=</span>tcp://localhost:4243 ./docker.py --pretty

<span class="c1"># Any container&#39;s ssh port exposed on 0.0.0.0 will be mapped to</span>
<span class="c1"># another IP address (where Ansible will attempt to connect via SSH)</span>
<span class="nv">DOCKER_DEFAULT_IP</span><span class="o">=</span><span class="m">192</span>.0.2.5 ./docker.py --pretty

<span class="c1"># Run as input to a playbook:</span>
ansible-playbook -i ~/projects/ansible/contrib/inventory/docker.py docker_inventory_test.yml

<span class="c1"># Simple playbook to invoke with the above example:</span>

    - name: Test docker_inventory, this will not connect to any hosts
      hosts: all
      gather_facts: no
      tasks:
        - debug: <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;Container - {{ inventory_hostname }}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>You can control the behavior of the inventory script by defining environment variables, or
creating a docker.yml file (sample provided in ansible/contrib/inventory). The order of precedence is the docker.yml
file and then environment variables.</p>
<div class="section" id="id1">
<h4>Environment Variables<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>To connect to a single Docker API the following variables can be defined in the environment to control the connection
options. These are the same environment variables used by the Docker modules.</p>
<blockquote>
<div><dl class="simple">
<dt>DOCKER_HOST</dt><dd><p>The URL or Unix socket path used to connect to the Docker API. Defaults to unix://var/run/docker.sock.</p>
</dd>
<dt>DOCKER_API_VERSION:</dt><dd><p>The version of the Docker API running on the Docker Host. Defaults to the latest version of the API supported
by docker-py.</p>
</dd>
<dt>DOCKER_TIMEOUT:</dt><dd><p>The maximum amount of time in seconds to wait on a response from the API. Defaults to 60 seconds.</p>
</dd>
<dt>DOCKER_TLS:</dt><dd><p>Secure the connection to the API by using TLS without verifying the authenticity of the Docker host server.
Defaults to False.</p>
</dd>
<dt>DOCKER_TLS_VERIFY:</dt><dd><p>Secure the connection to the API by using TLS and verifying the authenticity of the Docker host server.
Default is False</p>
</dd>
<dt>DOCKER_TLS_HOSTNAME:</dt><dd><p>When verifying the authenticity of the Docker Host server, provide the expected name of the server. Defaults
to localhost.</p>
</dd>
<dt>DOCKER_CERT_PATH:</dt><dd><p>Path to the directory containing the client certificate, client key and CA certificate.</p>
</dd>
<dt>DOCKER_SSL_VERSION:</dt><dd><p>Provide a valid SSL version number. Default value determined by docker-py, which at the time of this writing
was 1.0</p>
</dd>
</dl>
</div></blockquote>
<p>In addition to the connection variables there are a couple variables used to control the execution and output of the
script:</p>
<blockquote>
<div><dl class="simple">
<dt>DOCKER_CONFIG_FILE</dt><dd><p>Path to the configuration file. Defaults to ./docker.yml.</p>
</dd>
<dt>DOCKER_PRIVATE_SSH_PORT:</dt><dd><p>The private port (container port) on which SSH is listening for connections. Defaults to 22.</p>
</dd>
<dt>DOCKER_DEFAULT_IP:</dt><dd><p>The IP address to assign to ansible_host when the container’s SSH port is mapped to interface ‘0.0.0.0’.</p>
</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="configuration-file">
<h4>Configuration File<a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h4>
<p>Using a configuration file provides a means for defining a set of Docker APIs from which to build an inventory.</p>
<p>The default name of the file is derived from the name of the inventory script. By default the script will look for
basename of the script (i.e. docker) with an extension of ‘.yml’.</p>
<p>You can also override the default name of the script by defining DOCKER_CONFIG_FILE in the environment.</p>
<p>Here’s what you can define in docker_inventory.yml:</p>
<blockquote>
<div><dl class="simple">
<dt>defaults</dt><dd><p>Defines a default connection. Defaults will be taken from this and applied to any values not provided
for a host defined in the hosts list.</p>
</dd>
<dt>hosts</dt><dd><p>If you wish to get inventory from more than one Docker host, define a hosts list.</p>
</dd>
</dl>
</div></blockquote>
<p>For the default host and each host in the hosts list define the following attributes:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">host</span><span class="p">:</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The URL or Unix socket path used to connect to the Docker API.</span>
    <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="nt">tls</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Connect using TLS without verifying the authenticity of the Docker host server.</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">tls_verify</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Connect using TLS without verifying the authenticity of the Docker host server.</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">cert_path</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path to the client&#39;s TLS certificate file.</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">cacert_path</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Use a CA certificate when performing server verification by providing the path to a CA certificate file.</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">key_path</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path to the client&#39;s TLS key file.</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="nt">version</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The Docker API version.</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">will be supplied by the docker-py module.</span>

<span class="nt">timeout</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The amount of time in seconds to wait on an API response.</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">60</span>

<span class="nt">default_ip</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The IP address to assign to ansible_host when the container&#39;s SSH port is mapped to interface</span>
   <span class="s">&#39;0.0.0.0&#39;</span><span class="l l-Scalar l-Scalar-Plain">.</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>

<span class="nt">private_ssh_port</span><span class="p">:</span>
   <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The port containers use for SSH</span>
   <span class="nt">required</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
   <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="guide_kubernetes.html" class="btn btn-neutral float-right" title="Kubernetes and OpenShift Guide"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="virt_guides.html" class="btn btn-neutral" title="Virtualization and Containerization Guides"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on Aug 20, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>