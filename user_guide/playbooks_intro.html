

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Intro to Playbooks &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating Reusable Playbooks" href="playbooks_reuse.html" />
    <link rel="prev" title="Working With Playbooks" href="playbooks.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="2.9">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.9
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Ansible Quickstart Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_concepts.html">Ansible concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html">How to build your inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html">Working with dynamic inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html">Patterns: targeting hosts and groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html">Introduction to ad-hoc commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="connection_details.html">Connection methods and details</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line_tools.html">Working with command line tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="playbooks.html">Working With Playbooks</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Intro to Playbooks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#playbooks-intro">About Playbooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#playbook-language-example">Playbook Language Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basics">Basics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#action-shorthand">Action Shorthand</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handlers-running-operations-on-change">Handlers: Running Operations On Change</a></li>
<li class="toctree-l4"><a class="reference internal" href="#executing-a-playbook">Executing A Playbook</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ansible-pull">Ansible-Pull</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linting-playbooks">Linting playbooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-playbook-verification-options">Other playbook verification options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_reuse.html">Creating Reusable Playbooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_variables.html">Using Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_templating.html">Templating (Jinja2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_conditionals.html">Conditionals</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_loops.html">Loops</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_blocks.html">Blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_special_topics.html">Advanced Playbooks Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_strategies.html">Controlling playbook execution: strategies and more</a></li>
<li class="toctree-l3"><a class="reference internal" href="playbooks_best_practices.html">Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="guide_rolling_upgrade.html">Playbook Example: Continuous Delivery and Rolling Upgrades</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="become.html">Understanding privilege escalation: become</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html">Ansible Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Working With Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/plugins.html">Working With Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html">Ansible and BSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="windows.html">Windows Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="collections_using.html">Using collections</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible for Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Ansible for Network Automation</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">User Guide</a> &raquo;</li>
        
          <li><a href="playbooks.html">Working With Playbooks</a> &raquo;</li>
        
      <li>Intro to Playbooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/playbooks_intro.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="intro-to-playbooks">
<h1>Intro to Playbooks<a class="headerlink" href="#intro-to-playbooks" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#playbooks-intro" id="id8">About Playbooks</a></p></li>
<li><p><a class="reference internal" href="#playbook-language-example" id="id9">Playbook Language Example</a></p></li>
<li><p><a class="reference internal" href="#basics" id="id10">Basics</a></p>
<ul>
<li><p><a class="reference internal" href="#hosts-and-users" id="id11">Hosts and Users</a></p></li>
<li><p><a class="reference internal" href="#tasks-list" id="id12">Tasks list</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#action-shorthand" id="id13">Action Shorthand</a></p></li>
<li><p><a class="reference internal" href="#handlers-running-operations-on-change" id="id14">Handlers: Running Operations On Change</a></p></li>
<li><p><a class="reference internal" href="#executing-a-playbook" id="id15">Executing A Playbook</a></p></li>
<li><p><a class="reference internal" href="#ansible-pull" id="id16">Ansible-Pull</a></p></li>
<li><p><a class="reference internal" href="#linting-playbooks" id="id17">Linting playbooks</a></p></li>
<li><p><a class="reference internal" href="#other-playbook-verification-options" id="id18">Other playbook verification options</a></p></li>
</ul>
</div>
<div class="section" id="playbooks-intro">
<span id="about-playbooks"></span><span id="id1"></span><h2><a class="toc-backref" href="#id8">About Playbooks</a><a class="headerlink" href="#playbooks-intro" title="Permalink to this headline">¶</a></h2>
<p>Playbooks are a completely different way to use ansible than in ad-hoc task execution mode, and are
particularly powerful.</p>
<p>Simply put, playbooks are the basis for a really simple configuration management and multi-machine deployment system,
unlike any that already exist, and one that is very well suited to deploying complex applications.</p>
<p>Playbooks can declare configurations, but they can also orchestrate steps of
any manual ordered process, even as different steps must bounce back and forth
between sets of machines in particular orders.  They can launch tasks
synchronously or asynchronously.</p>
<p>While you might run the main <code class="docutils literal notranslate"><span class="pre">/usr/bin/ansible</span></code> program for ad-hoc
tasks, playbooks are more likely to be kept in source control and used
to push out your configuration or assure the configurations of your
remote systems are in spec.</p>
<p>There are also some full sets of playbooks illustrating a lot of these techniques in the
<a class="reference external" href="https://github.com/ansible/ansible-examples">ansible-examples repository</a>.  We’d recommend
looking at these in another tab as you go along.</p>
<p>There are also many jumping off points after you learn playbooks, so hop back to the documentation
index after you’re done with this section.</p>
</div>
<div class="section" id="playbook-language-example">
<span id="id2"></span><h2><a class="toc-backref" href="#id9">Playbook Language Example</a><a class="headerlink" href="#playbook-language-example" title="Permalink to this headline">¶</a></h2>
<p>Playbooks are expressed in YAML format (see <a class="reference internal" href="../reference_appendices/YAMLSyntax.html#yaml-syntax"><span class="std std-ref">YAML Syntax</span></a>) and have a minimum of syntax, which intentionally
tries to not be a programming language or script, but rather a model of a configuration or a process.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some editors have add-ons that can help you write clean YAML syntax in your playbooks. See <a class="reference internal" href="../community/other_tools_and_programs.html#other-tools-and-programs"><span class="std std-ref">Other Tools And Programs</span></a> for details.</p>
</div>
<p>Each playbook is composed of one or more ‘plays’ in a list.</p>
<p>The goal of a play is to map a group of hosts to some well defined roles, represented by
things ansible calls tasks.  At a basic level, a task is nothing more than a call
to an ansible module.</p>
<p>By composing a playbook of multiple ‘plays’, it is possible to
orchestrate multi-machine deployments, running certain steps on all
machines in the webservers group, then certain steps on the database
server group, then more commands back on the webservers group, etc.</p>
<p>“plays” are more or less a sports analogy.  You can have quite a lot of plays that affect your systems
to do different things.  It’s not as if you were just defining one particular state or model, and you
can run different plays at different times.</p>
<p id="apache-playbook">For starters, here’s a playbook, <code class="docutils literal notranslate"><span class="pre">verify-apache.yml</span></code> that contains just one play:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">http_port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="nt">max_clients</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure apache is at the latest version</span>
    <span class="nt">yum</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">latest</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write the apache config file</span>
    <span class="nt">template</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/srv/httpd.j2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/httpd.conf</span>
    <span class="nt">notify</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure apache is running</span>
    <span class="nt">service</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</pre></div>
</div>
<p>Playbooks can contain multiple plays. You may have a playbook that targets first
the web servers, and then the database servers. For example:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>

  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure apache is at the latest version</span>
    <span class="nt">yum</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">latest</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write the apache config file</span>
    <span class="nt">template</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/srv/httpd.j2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/httpd.conf</span>

<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">databases</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>

  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure postgresql is at the latest version</span>
    <span class="nt">yum</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgresql</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">latest</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ensure that postgresql is started</span>
    <span class="nt">service</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgresql</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
</pre></div>
</div>
<p>You can use this method to switch between the host group you’re targeting,
the username logging into the remote servers, whether to sudo or not, and so
forth. Plays, like tasks, run in the order specified in the playbook: top to
bottom.</p>
<p>Below, we’ll break down what the various features of the playbook language are.</p>
</div>
<div class="section" id="basics">
<span id="playbook-basics"></span><h2><a class="toc-backref" href="#id10">Basics</a><a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hosts-and-users">
<span id="playbook-hosts-and-users"></span><h3><a class="toc-backref" href="#id11">Hosts and Users</a><a class="headerlink" href="#hosts-and-users" title="Permalink to this headline">¶</a></h3>
<p>For each play in a playbook, you get to choose which machines in your infrastructure
to target and what remote user to complete the steps (called tasks) as.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hosts</span></code> line is a list of one or more groups or host patterns,
separated by colons, as described in the <a class="reference internal" href="intro_patterns.html#intro-patterns"><span class="std std-ref">Patterns: targeting hosts and groups</span></a>
documentation.  The <code class="docutils literal notranslate"><span class="pre">remote_user</span></code> is just the name of the user account:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">remote_user</span></code> parameter was formerly called just <code class="docutils literal notranslate"><span class="pre">user</span></code>. It was renamed in Ansible 1.4 to make it more distinguishable from the <strong>user</strong> module (used to create users on remote systems).</p>
</div>
<p>Remote users can also be defined per task:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">test connection</span>
      <span class="nt">ping</span><span class="p">:</span>
      <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yourname</span>
</pre></div>
</div>
<p>Support for running things as another user is also available (see <a class="reference internal" href="become.html#become"><span class="std std-ref">Understanding privilege escalation: become</span></a>):</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yourname</span>
  <span class="nt">become</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
<p>You can also use keyword <code class="docutils literal notranslate"><span class="pre">become</span></code> on a particular task instead of the whole play:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yourname</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
      <span class="nt">become</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
      <span class="nt">become_method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sudo</span>
</pre></div>
</div>
<p>You can also login as you, and then become a user different than root:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yourname</span>
  <span class="nt">become</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">become_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres</span>
</pre></div>
</div>
<p>You can also use other privilege escalation methods, like su:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">webservers</span>
  <span class="nt">remote_user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yourname</span>
  <span class="nt">become</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">become_method</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">su</span>
</pre></div>
</div>
<p>If you need to specify a password for sudo, run <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> with <code class="docutils literal notranslate"><span class="pre">--ask-become-pass</span></code> or <code class="docutils literal notranslate"><span class="pre">-K</span></code>.
If you run a playbook utilizing <code class="docutils literal notranslate"><span class="pre">become</span></code> and the playbook seems to hang, it’s probably stuck at the privilege
escalation prompt and can be stopped using <cite>Control-C</cite>, allowing you to re-execute the playbook adding the
appropriate password.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">become_user</span></code> to a user other than root, the module
arguments are briefly written into a random tempfile in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>.
These are deleted immediately after the command is executed.  This
only occurs when changing privileges from a user like ‘bob’ to ‘timmy’,
not when going from ‘bob’ to ‘root’, or logging in directly as ‘bob’ or
‘root’.  If it concerns you that this data is briefly readable
(not writable), avoid transferring unencrypted passwords with
<cite>become_user</cite> set.  In other cases, <code class="docutils literal notranslate"><span class="pre">/tmp</span></code> is not used and this does
not come into play. Ansible also takes care to not log password
parameters.</p>
</div>
<div class="versionadded" id="order">
<p><span class="versionmodified added">New in version 2.4.</span></p>
</div>
<p>You can also control the order in which hosts are run. The default is to follow the order supplied by the inventory:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="nt">order</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sorted</span>
  <span class="nt">gather_facts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">inventory_hostname</span>
</pre></div>
</div>
<p>Possible values for order are:</p>
<dl class="simple">
<dt>inventory:</dt><dd><p>The default. The order is ‘as provided’ by the inventory</p>
</dd>
<dt>reverse_inventory:</dt><dd><p>As the name implies, this reverses the order ‘as provided’ by the inventory</p>
</dd>
<dt>sorted:</dt><dd><p>Hosts are alphabetically sorted by name</p>
</dd>
<dt>reverse_sorted:</dt><dd><p>Hosts are sorted by name in reverse alphabetical order</p>
</dd>
<dt>shuffle:</dt><dd><p>Hosts are randomly ordered each run</p>
</dd>
</dl>
</div>
<div class="section" id="tasks-list">
<span id="id3"></span><h3><a class="toc-backref" href="#id12">Tasks list</a><a class="headerlink" href="#tasks-list" title="Permalink to this headline">¶</a></h3>
<p>Each play contains a list of tasks.  Tasks are executed in order, one
at a time, against all machines matched by the host pattern,
before moving on to the next task.  It is important to understand that, within a play,
all hosts are going to get the same task directives.  It is the purpose of a play to map
a selection of hosts to tasks.</p>
<p>When running the playbook, which runs top to bottom, hosts with failed tasks are
taken out of the rotation for the entire playbook.  If things fail, simply correct the playbook file and rerun.</p>
<p>The goal of each task is to execute a module, with very specific arguments.
Variables can be used in arguments to modules.</p>
<p>Modules should be idempotent, that is, running a module multiple times
in a sequence should have the same effect as running it just once. One
way to achieve idempotency is to have a module check whether its desired
final state has already been achieved, and if that state has been achieved,
to exit without performing any actions. If all the modules a playbook uses
are idempotent, then the playbook itself is likely to be idempotent, so
re-running the playbook should be safe.</p>
<p>The <strong>command</strong> and <strong>shell</strong> modules will typically rerun the same command again,
which is totally ok if the command is something like
<code class="docutils literal notranslate"><span class="pre">chmod</span></code> or <code class="docutils literal notranslate"><span class="pre">setsebool</span></code>, etc.  Though there is a <code class="docutils literal notranslate"><span class="pre">creates</span></code> flag available which can
be used to make these modules also idempotent.</p>
<p>Every task should have a <code class="docutils literal notranslate"><span class="pre">name</span></code>, which is included in the output from
running the playbook.   This is human readable output, and so it is
useful to provide good descriptions of each task step.  If the name
is not provided though, the string fed to ‘action’ will be used for
output.</p>
<p>Tasks can be declared using the legacy <code class="docutils literal notranslate"><span class="pre">action:</span> <span class="pre">module</span> <span class="pre">options</span></code> format, but
it is recommended that you use the more conventional <code class="docutils literal notranslate"><span class="pre">module:</span> <span class="pre">options</span></code> format.
This recommended format is used throughout the documentation, but you may
encounter the older format in some playbooks.</p>
<p>Here is what a basic task looks like. As with most modules,
the service module takes <code class="docutils literal notranslate"><span class="pre">key=value</span></code> arguments:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">make sure apache is running</span>
    <span class="nt">service</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">httpd</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
</pre></div>
</div>
<p>The <strong>command</strong> and <strong>shell</strong> modules are the only modules that just take a list
of arguments and don’t use the <code class="docutils literal notranslate"><span class="pre">key=value</span></code> form.  This makes
them work as simply as you would expect:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">enable selinux</span>
    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/sbin/setenforce 1</span>
</pre></div>
</div>
<p>The <strong>command</strong> and <strong>shell</strong> module care about return codes, so if you have a command
whose successful exit code is not zero, you may wish to do this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">run this command and ignore the result</span>
    <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/somecommand || /bin/true</span>
</pre></div>
</div>
<p>Or this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">run this command and ignore the result</span>
    <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/bin/somecommand</span>
    <span class="nt">ignore_errors</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>If the action line is getting too long for comfort you can break it on
a space and indent any continuation lines:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy ansible inventory file to client</span>
    <span class="nt">copy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src=/etc/ansible/hosts dest=/etc/ansible/hosts</span>
            <span class="l l-Scalar l-Scalar-Plain">owner=root group=root mode=0644</span>
</pre></div>
</div>
<p>Variables can be used in action lines.   Suppose you defined
a variable called <code class="docutils literal notranslate"><span class="pre">vhost</span></code> in the <code class="docutils literal notranslate"><span class="pre">vars</span></code> section, you could do this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">create a virtual host file for</span> <span class="cp">{{</span> <span class="nv">vhost</span> <span class="cp">}}</span>
    <span class="nt">template</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">somefile.j2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/httpd/conf.d/</span><span class="cp">{{</span> <span class="nv">vhost</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Those same variables are usable in templates, which we’ll get to later.</p>
<p>Now in a very basic playbook all the tasks will be listed directly in that play, though it will usually
make more sense to break up tasks as described in <a class="reference internal" href="playbooks_reuse.html#playbooks-reuse"><span class="std std-ref">Creating Reusable Playbooks</span></a>.</p>
</div>
</div>
<div class="section" id="action-shorthand">
<span id="id4"></span><h2><a class="toc-backref" href="#id13">Action Shorthand</a><a class="headerlink" href="#action-shorthand" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.8.</span></p>
</div>
<p>Ansible prefers listing modules like this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">templates/foo.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/foo.conf</span>
</pre></div>
</div>
<p>Early versions of Ansible used the following format, which still works:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">action</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">template src=templates/foo.j2 dest=/etc/foo.conf</span>
</pre></div>
</div>
</div>
<div class="section" id="handlers-running-operations-on-change">
<span id="handlers"></span><h2><a class="toc-backref" href="#id14">Handlers: Running Operations On Change</a><a class="headerlink" href="#handlers-running-operations-on-change" title="Permalink to this headline">¶</a></h2>
<p>As we’ve mentioned, modules should be idempotent and can relay when
they have made a change on the remote system.   Playbooks recognize this and
have a basic event system that can be used to respond to change.</p>
<p>These ‘notify’ actions are triggered at the end of each block of tasks in a play, and will only be
triggered once even if notified by multiple different tasks.</p>
<p>For instance, multiple resources may indicate
that apache needs to be restarted because they have changed a config file,
but apache will only be bounced once to avoid unnecessary restarts.</p>
<p>Here’s an example of restarting two services when the contents of a file
change, but only if the file changes:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">template configuration file</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">template.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/foo.conf</span>
  <span class="nt">notify</span><span class="p">:</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
     <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
</pre></div>
</div>
<p>The things listed in the <code class="docutils literal notranslate"><span class="pre">notify</span></code> section of a task are called
handlers.</p>
<p>Handlers are lists of tasks, not really any different from regular
tasks, that are referenced by a globally unique name, and are notified
by notifiers.  If nothing notifies a handler, it will not
run.  Regardless of how many tasks notify a handler, it will run only
once, after all of the tasks complete in a particular play.</p>
<p>Here’s an example handlers section:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">memcached</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apache</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</pre></div>
</div>
<p>You may want your Ansible handlers to use variables. For example, if the name of a service varies slightly by distribution, you want your output to show the exact name of the restarted service for each target machine. Avoid placing variables in the name of the handler. Since handler names are templated early on, Ansible may not have a value available for a handler name like this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">handlers</span><span class="p">:</span>
<span class="c1"># this handler name may cause your play to fail!</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart &quot;</span><span class="cp">{{</span> <span class="nv">web_service_name</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
</pre></div>
</div>
<p>If the variable used in the handler name is not available, the entire play fails. Changing that variable mid-play <strong>will not</strong> result in newly created handler.</p>
<p>Instead, place variables in the task parameters of your handler. You can load the values using <code class="docutils literal notranslate"><span class="pre">include_vars</span></code> like this:</p>
<blockquote>
<div><div class="highlight-yaml+jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set host variables based on distribution</span>
    <span class="nt">include_vars</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">ansible_facts.distribution</span> <span class="cp">}}</span><span class="s">.yml&quot;</span>

<span class="nt">handlers</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart web service</span>
    <span class="nt">service</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">web_service_name</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;httpd&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span>
      <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
</pre></div>
</div>
</div></blockquote>
<p>As of Ansible 2.2, handlers can also “listen” to generic topics, and tasks can notify those topics as follows:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">handlers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart memcached</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">memcached</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
      <span class="nt">listen</span><span class="p">:</span> <span class="s">&quot;restart</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">services&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart apache</span>
      <span class="nt">service</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apache</span>
        <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restarted</span>
      <span class="nt">listen</span><span class="p">:</span> <span class="s">&quot;restart</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">services&quot;</span>

<span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart everything</span>
      <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &quot;this task will restart the web services&quot;</span>
      <span class="nt">notify</span><span class="p">:</span> <span class="s">&quot;restart</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">services&quot;</span>
</pre></div>
</div>
<p>This use makes it much easier to trigger multiple handlers. It also decouples handlers from their names,
making it easier to share handlers among playbooks and roles (especially when using 3rd party roles from
a shared source like Galaxy).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Notify handlers are always run in the same order they are defined, <cite>not</cite> in the order listed in the notify-statement. This is also the case for handlers using <cite>listen</cite>.</p></li>
<li><p>Handler names and <cite>listen</cite> topics live in a global namespace.</p></li>
<li><p>Handler names are templatable and <cite>listen</cite> topics are not.</p></li>
<li><p>Use unique handler names. If you trigger more than one handler with the same name, the first one(s) get overwritten. Only the last one defined will run.</p></li>
<li><p>You cannot notify a handler that is defined inside of an include. As of Ansible 2.1, this does work, however the include must be <cite>static</cite>.</p></li>
</ul>
</div>
<p>Roles are described later on, but it’s worthwhile to point out that:</p>
<ul class="simple">
<li><p>handlers notified within <code class="docutils literal notranslate"><span class="pre">pre_tasks</span></code>, <code class="docutils literal notranslate"><span class="pre">tasks</span></code>, and <code class="docutils literal notranslate"><span class="pre">post_tasks</span></code> sections are automatically flushed in the end of section where they were notified,</p></li>
<li><p>handlers notified within <code class="docutils literal notranslate"><span class="pre">roles</span></code> section are automatically flushed in the end of <code class="docutils literal notranslate"><span class="pre">tasks</span></code> section, but before any <code class="docutils literal notranslate"><span class="pre">tasks</span></code> handlers,</p></li>
<li><p>handlers are play scoped and as such can be used outside of the role they are defined in.</p></li>
</ul>
<p>If you ever want to flush all the handler commands immediately you can do this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">tasks</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some tasks go here</span>
   <span class="p p-Indicator">-</span> <span class="nt">meta</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>
   <span class="p p-Indicator">-</span> <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some other tasks</span>
</pre></div>
</div>
<p>In the above example any queued up handlers would be processed early when the <code class="docutils literal notranslate"><span class="pre">meta</span></code>
statement was reached.  This is a bit of a niche case but can come in handy from
time to time.</p>
</div>
<div class="section" id="executing-a-playbook">
<span id="id5"></span><h2><a class="toc-backref" href="#id15">Executing A Playbook</a><a class="headerlink" href="#executing-a-playbook" title="Permalink to this headline">¶</a></h2>
<p>Now that you’ve learned playbook syntax, how do you run a playbook?  It’s simple.
Let’s run a playbook using a parallelism level of 10:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-playbook playbook.yml -f 10</span>
</pre></div>
</div>
</div>
<div class="section" id="ansible-pull">
<span id="playbook-ansible-pull"></span><h2><a class="toc-backref" href="#id16">Ansible-Pull</a><a class="headerlink" href="#ansible-pull" title="Permalink to this headline">¶</a></h2>
<p>Should you want to invert the architecture of Ansible, so that nodes check in to a central location, instead
of pushing configuration out to them, you can.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ansible-pull</span></code> is a small script that will checkout a repo of configuration instructions from git, and then
run <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> against that content.</p>
<p>Assuming you load balance your checkout location, <code class="docutils literal notranslate"><span class="pre">ansible-pull</span></code> scales essentially infinitely.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">ansible-pull</span> <span class="pre">--help</span></code> for details.</p>
<p>There’s also a <a class="reference external" href="https://github.com/ansible/ansible-examples/blob/master/language_features/ansible_pull.yml">clever playbook</a> available to configure <code class="docutils literal notranslate"><span class="pre">ansible-pull</span></code> via a crontab from push mode.</p>
</div>
<div class="section" id="linting-playbooks">
<span id="id6"></span><h2><a class="toc-backref" href="#id17">Linting playbooks</a><a class="headerlink" href="#linting-playbooks" title="Permalink to this headline">¶</a></h2>
<p>You can use <a class="reference external" href="https://docs.ansible.com/ansible-lint/index.html">ansible-lint</a> to run a detail check of your playbooks before you execute them.</p>
<p>For example, if you run <code class="docutils literal notranslate"><span class="pre">ansible-lint</span></code> on the <a class="reference internal" href="#apache-playbook"><span class="std std-ref">verify-apache.yml playbook</span></a> introduced earlier in this section, you’ll get the following results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ansible-lint verify-apache.yml
<span class="o">[</span><span class="m">403</span><span class="o">]</span> Package installs should not use latest
verify-apache.yml:8
Task/Handler: ensure apache is at the latest version
</pre></div>
</div>
<p>The <a class="reference external" href="https://docs.ansible.com/ansible-lint/rules/default_rules.html">ansible-lint default rules</a> page describes each error. For <code class="docutils literal notranslate"><span class="pre">[403]</span></code>, the recommended fix is to change <code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">latest</span></code> to <code class="docutils literal notranslate"><span class="pre">state:</span> <span class="pre">present</span></code> in the playbook.</p>
</div>
<div class="section" id="other-playbook-verification-options">
<h2><a class="toc-backref" href="#id18">Other playbook verification options</a><a class="headerlink" href="#other-playbook-verification-options" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../community/other_tools_and_programs.html#validate-playbook-tools"><span class="std std-ref">Tools for Validating Playbooks</span></a> for a detailed list of tools you can use to verify your playbooks. Here are some others that you should consider:</p>
<ul>
<li><p>To check the syntax of a playbook, use <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> with the <code class="docutils literal notranslate"><span class="pre">--syntax-check</span></code> flag. This will run the
playbook file through the parser to ensure its included files, roles, etc. have no syntax problems.</p></li>
<li><p>Look at the bottom of the playbook execution for a summary of the nodes that were targeted
and how they performed. General failures and fatal “unreachable” communication attempts are kept separate in the counts.</p></li>
<li><p>If you ever want to see detailed output from successful modules as well as unsuccessful ones,
use the <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> flag.  This is available in Ansible 0.5 and later.</p></li>
<li><p>To see what hosts would be affected by a playbook before you run it, you
can do this:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ansible-playbook playbook.yml --list-hosts</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference external" href="https://docs.ansible.com/ansible-lint/index.html">ansible-lint</a></dt><dd><p>Learn how to test Ansible Playbooks syntax</p>
</dd>
<dt><a class="reference internal" href="../reference_appendices/YAMLSyntax.html#yaml-syntax"><span class="std std-ref">YAML Syntax</span></a></dt><dd><p>Learn about YAML syntax</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html#playbooks-best-practices"><span class="std std-ref">Best Practices</span></a></dt><dd><p>Various tips about managing playbooks in the real world</p>
</dd>
<dt><a class="reference internal" href="../modules/list_of_all_modules.html#all-modules"><span class="std std-ref">All modules</span></a></dt><dd><p>Learn about available modules</p>
</dd>
<dt><a class="reference internal" href="../dev_guide/developing_modules.html#developing-modules"><span class="std std-ref">Should you develop a module?</span></a></dt><dd><p>Learn how to extend Ansible by writing your own modules</p>
</dd>
<dt><a class="reference internal" href="intro_patterns.html#intro-patterns"><span class="std std-ref">Patterns: targeting hosts and groups</span></a></dt><dd><p>Learn about how to select hosts</p>
</dd>
<dt><a class="reference external" href="https://github.com/ansible/ansible-examples">GitHub examples directory</a></dt><dd><p>Complete end-to-end playbook examples</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-project">Mailing List</a></dt><dd><p>Questions? Help? Ideas?  Stop by the list on Google Groups</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="playbooks_reuse.html" class="btn btn-neutral float-right" title="Creating Reusable Playbooks"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="playbooks.html" class="btn btn-neutral" title="Working With Playbooks"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on May 28, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>