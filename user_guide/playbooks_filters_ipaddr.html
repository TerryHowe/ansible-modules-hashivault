

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ipaddr filter &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters_ipaddr.html"/>
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/ansible.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> <!---- extra head elements for Ansible beyond RTD Sphinx Theme --->
<script type="text/javascript" src="//www.redhat.com/dtm.js"></script>
<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="2.9">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->

<script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script> 
</head>

<body class="wy-body-for-nav">
   <!---- extra body elements for Ansible beyond RTD Sphinx Theme --->
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

  <div class="DocSite-globalNav ansibleNav">
      <ul>
          <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
          <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
          <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
          <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
          <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
      </ul>
  </div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../_static/images/logo_invert.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">
    Documentation
  </div>
</a> 
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ansible
          

          
          </a>

          
            
            
              <div class="version">
                2.9
              </div>
            
          

          <!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <div class="version-dropdown">
      <select class="version-list" id="version-list" onchange="javascript:location.href = this.value;">
        <script> x = document.getElementById("version-list"); </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "latest";
            if ( "latest" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","latest");
            } else {
              option.value = current_url.replace("latest","latest");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.8";
            if ( "2.8" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.8");
            } else {
              option.value = current_url.replace("latest","2.8");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "2.7";
            if ( "2.7" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","2.7");
            } else {
              option.value = current_url.replace("latest","2.7");
            }
            x.add(option);
          </script>
        
          <script>
            current_url = window.location.href;
            option = document.createElement("option");
            option.text = "devel";
            if ( "devel" == "2.9" ) {
              option.selected = true;
            }
            if (current_url.search("2.9") > -1) {
              option.value = current_url.replace("2.9","devel");
            } else {
              option.value = current_url.replace("latest","devel");
            }
            x.add(option);
          </script>
        
      </select>
    </div>
  
</div>
          
<div role="search">
<!--  <form id="rtd-search-form" class="wy-form" action="../search.html" -->
  <form id="rtd-search-form" class="wy-form"  method="get">
    <input type="text" class="st-default-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible for Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">Ansible for Network Automation</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/tower.html">Red Hat Ansible Tower</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
        
         <!-- extra nav elements for Ansible beyond RTD Sphinx Theme --->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>
      </div>
    </nav>
  </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ansible</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>ipaddr filter</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <!-- Ansible-specific additions for modules etc -->
                
                  <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/playbooks_filters_ipaddr.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="fa fa-github"> Edit on GitHub</a>
                
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <!--- Based on sphinx versionwarning extension. Extension currently only works on READTHEDOCS -->
  <script>
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">');
      para = document.createElement('p');
      banner_text=document.createTextNode("This is a testing site. For the official docs go to https://docs.ansible.com/");
      para.appendChild(banner_text);
      element = document.getElementById('testing_banner_id');
      element.appendChild(para);
      document.write('</div>');
    }

    // Create a banner if we're not the latest version
    current_url = window.location.href;
    if ((current_url.search("latest") > -1) || (current_url.search("/2.9/") > -1)) {
     // no banner for latest release
    } else if (current_url.search("devel") > -1) {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading the *devel* version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    } else {
      document.write('<div id="banner_id" class="admonition caution">');
      para = document.createElement('p');
      banner_text=document.createTextNode("You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the latest stable released version.");
      para.appendChild(banner_text);
      element = document.getElementById('banner_id');
      element.appendChild(para);
      document.write('</div>');
    }
  </script>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ipaddr-filter">
<span id="playbooks-filters-ipaddr"></span><h1>ipaddr filter<a class="headerlink" href="#ipaddr-filter" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.9.</span></p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> is a Jinja2 filter designed to provide an interface to the <a class="reference external" href="https://pypi.org/project/netaddr/">netaddr</a>
Python package from within Ansible. It can operate on strings or lists of
items, test various data to check if they are valid IP addresses, and manipulate
the input data to extract requested information. <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> works with both
IPv4 and IPv6 addresses in various forms. There are also additional functions
available to manipulate IP subnets and MAC addresses.</p>
<p>To use this filter in Ansible, you need to install the <a class="reference external" href="https://pypi.org/project/netaddr/">netaddr</a> Python library on
a computer on which you use Ansible (it is not required on remote hosts).
It can usually be installed with either your system package manager or using
<code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">pip install netaddr</span>
</pre></div>
</div>
<div class="contents local topic" id="topics">
<p class="topic-title">Topics</p>
<ul class="simple">
<li><p><a class="reference internal" href="#basic-tests" id="id1">Basic tests</a></p></li>
<li><p><a class="reference internal" href="#filtering-lists" id="id2">Filtering lists</a></p></li>
<li><p><a class="reference internal" href="#wrapping-ipv6-addresses-in-brackets" id="id3">Wrapping IPv6 addresses in [ ] brackets</a></p></li>
<li><p><a class="reference internal" href="#basic-queries" id="id4">Basic queries</a></p></li>
<li><p><a class="reference internal" href="#getting-information-about-hosts-and-networks" id="id5">Getting information about hosts and networks</a></p></li>
<li><p><a class="reference internal" href="#getting-information-from-host-prefix-values" id="id6">Getting information from host/prefix values</a></p></li>
<li><p><a class="reference internal" href="#converting-subnet-masks-to-cidr-notation" id="id7">Converting subnet masks to CIDR notation</a></p></li>
<li><p><a class="reference internal" href="#getting-information-about-the-network-in-cidr-notation" id="id8">Getting information about the network in CIDR notation</a></p></li>
<li><p><a class="reference internal" href="#ip-address-conversion" id="id9">IP address conversion</a></p></li>
<li><p><a class="reference internal" href="#converting-ipv4-address-to-a-6to4-address" id="id10">Converting IPv4 address to a 6to4 address</a></p></li>
<li><p><a class="reference internal" href="#finding-ip-addresses-within-a-range" id="id11">Finding IP addresses within a range</a></p></li>
<li><p><a class="reference internal" href="#ip-math" id="id12">IP Math</a></p></li>
<li><p><a class="reference internal" href="#subnet-manipulation" id="id13">Subnet manipulation</a></p></li>
<li><p><a class="reference internal" href="#subnet-merging" id="id14">Subnet Merging</a></p></li>
<li><p><a class="reference internal" href="#mac-address-filter" id="id15">MAC address filter</a></p></li>
</ul>
</div>
<div class="section" id="basic-tests">
<h2><a class="toc-backref" href="#topics">Basic tests</a><a class="headerlink" href="#basic-tests" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> is designed to return the input value if a query is True, and
<code class="docutils literal notranslate"><span class="pre">False</span></code> if a query is False. This way it can be easily used in chained
filters. To use the filter, pass a string to it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{{ &#39;192.0.2.0&#39; | ipaddr }}
</pre></div>
</div>
<p>You can also pass the values as variables:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ipaddr</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Here are some example test results of various input strings:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># These values are valid IP addresses or network ranges</span>
<span class="s">&#39;192.168.0.1&#39;</span>       <span class="l l-Scalar l-Scalar-Plain">-&gt; 192.168.0.1</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;192.168.32.0/24&#39;   -&gt; 192.168.32.0/24</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;fe80::100/10&#39;      -&gt; fe80::100/10</span>
<span class="l l-Scalar l-Scalar-Plain">45443646733         -&gt; ::a:94a7:50d</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;523454/24&#39;         -&gt; 0.7.252.190/24</span>

<span class="l l-Scalar l-Scalar-Plain"># Values that are not valid IP addresses or network ranges</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;localhost&#39;         -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">True                -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;space bar&#39;         -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">False               -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;&#39;                  -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;:&#39;                 -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;fe80:/10&#39;          -&gt; False</span>
</pre></div>
</div>
<p>Sometimes you need either IPv4 or IPv6 addresses. To filter only for a particular
type, <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter has two “aliases”, <code class="docutils literal notranslate"><span class="pre">ipv4()</span></code> and <code class="docutils literal notranslate"><span class="pre">ipv6()</span></code>.</p>
<p>Example use of an IPv4 filter:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ipv4</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>A similar example of an IPv6 filter:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="nv">myvar</span> <span class="o">|</span> <span class="nf">ipv6</span> <span class="cp">}}</span>
</pre></div>
</div>
<p>Here’s some example test results to look for IPv4 addresses:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&#39;192.168.0.1&#39;</span>       <span class="l l-Scalar l-Scalar-Plain">-&gt; 192.168.0.1</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;192.168.32.0/24&#39;   -&gt; 192.168.32.0/24</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;fe80::100/10&#39;      -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">45443646733         -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;523454/24&#39;         -&gt; 0.7.252.190/24</span>
</pre></div>
</div>
<p>And the same data filtered for IPv6 addresses:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="s">&#39;192.168.0.1&#39;</span>       <span class="l l-Scalar l-Scalar-Plain">-&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;192.168.32.0/24&#39;   -&gt; False</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;fe80::100/10&#39;      -&gt; fe80::100/10</span>
<span class="l l-Scalar l-Scalar-Plain">45443646733         -&gt; ::a:94a7:50d</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;523454/24&#39;         -&gt; False</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-lists">
<h2><a class="toc-backref" href="#topics">Filtering lists</a><a class="headerlink" href="#filtering-lists" title="Permalink to this headline">¶</a></h2>
<p>You can filter entire lists - <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> will return a list with values
valid for a particular query:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example list of values</span>
<span class="l l-Scalar l-Scalar-Plain">test_list = [&#39;192.24.2.1&#39;, &#39;host.fqdn&#39;, &#39;::1&#39;, &#39;192.168.32.0/24&#39;, &#39;fe80::100/10&#39;, True, &#39;&#39;, &#39;42540766412265424405338506004571095040/64&#39;]</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">[&#39;192.24.2.1&#39;, &#39;::1&#39;, &#39;192.168.32.0/24&#39;, &#39;fe80::100/10&#39;, &#39;2001:db8:32c:faad::/64&#39;]</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv4</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">[&#39;192.24.2.1&#39;, &#39;192.168.32.0/24&#39;]</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv6</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">[&#39;::1&#39;, &#39;fe80::100/10&#39;, &#39;2001:db8:32c:faad::/64&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapping-ipv6-addresses-in-brackets">
<h2><a class="toc-backref" href="#topics">Wrapping IPv6 addresses in [ ] brackets</a><a class="headerlink" href="#wrapping-ipv6-addresses-in-brackets" title="Permalink to this headline">¶</a></h2>
<p>Some configuration files require IPv6 addresses to be “wrapped” in square
brackets (<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">]</span></code>). To accomplish that, you can use the <code class="docutils literal notranslate"><span class="pre">ipwrap()</span></code> filter. It
will wrap all IPv6 addresses and leave any other strings intact:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipwrap</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;host.fqdn&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[::1]&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[fe80::100]/10&#39;</span><span class="p p-Indicator">,</span> <span class="nv">True</span><span class="p p-Indicator">,</span> <span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[2001:db8:32c:faad::]/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>As you can see, <code class="docutils literal notranslate"><span class="pre">ipwrap()</span></code> did not filter out non-IP address values, which is
usually what you want when for example you are mixing IP addresses with
hostnames. If you still want to filter out all non-IP address values, you can
chain both filters together:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span> <span class="o">|</span> <span class="nf">ipwrap</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[::1]&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[fe80::100]/10&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;[2001:db8:32c:faad::]/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-queries">
<h2><a class="toc-backref" href="#topics">Basic queries</a><a class="headerlink" href="#basic-queries" title="Permalink to this headline">¶</a></h2>
<p>You can provide a single argument to each <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter. The filter will then
treat it as a query and return values modified by that query. Lists will
contain only values that you are querying for.</p>
<p>Types of queries include:</p>
<ul class="simple">
<li><p>query by name: <code class="docutils literal notranslate"><span class="pre">ipaddr('address')</span></code>, <code class="docutils literal notranslate"><span class="pre">ipv4('network')</span></code>;</p></li>
<li><p>query by CIDR range: <code class="docutils literal notranslate"><span class="pre">ipaddr('192.168.0.0/24')</span></code>, <code class="docutils literal notranslate"><span class="pre">ipv6('2001:db8::/32')</span></code>;</p></li>
<li><p>query by index number: <code class="docutils literal notranslate"><span class="pre">ipaddr('1')</span></code>, <code class="docutils literal notranslate"><span class="pre">ipaddr('-1')</span></code>;</p></li>
</ul>
<p>If a query type is not recognized, Ansible will raise an error.</p>
</div>
<div class="section" id="getting-information-about-hosts-and-networks">
<h2><a class="toc-backref" href="#topics">Getting information about hosts and networks</a><a class="headerlink" href="#getting-information-about-hosts-and-networks" title="Permalink to this headline">¶</a></h2>
<p>Here’s our test list again:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example list of values</span>
<span class="l l-Scalar l-Scalar-Plain">test_list = [&#39;192.24.2.1&#39;, &#39;host.fqdn&#39;, &#39;::1&#39;, &#39;192.168.32.0/24&#39;, &#39;fe80::100/10&#39;, True, &#39;&#39;, &#39;42540766412265424405338506004571095040/64&#39;]</span>
</pre></div>
</div>
<p>Let’s take the list above and get only those elements that are host IP addresses
and not network ranges:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;::1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;fe80::100&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>As you can see, even though some values had a host address with a CIDR prefix,
they were dropped by the filter. If you want host IP addresses with their correct
CIDR prefixes (as is common with IPv6 addressing), you can use the
<code class="docutils literal notranslate"><span class="pre">ipaddr('host')</span></code> filter:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;host&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1/32&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;::1/128&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;fe80::100/10&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Filtering by IP address type also works:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv4</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv6</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;::1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;fe80::100&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can check if IP addresses or network ranges are accessible on a public
Internet, or if they are in private networks:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;public&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad::/64&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;private&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;fe80::100/10&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can check which values are specifically network ranges:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad::/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can also check how many IP addresses can be in a certain range:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;size&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="nv">256</span><span class="p p-Indicator">,</span> <span class="nv">18446744073709551616L</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>By specifying a network range as a query, you can check if a given value is in
that range:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;192.0.0.0/8&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>If you specify a positive or negative integer as a query, <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> will
treat this as an index and will return the specific IP address from a network
range, in the ‘host/prefix’ format:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># First IP address (network address)</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;0&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad::/64&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># Second IP address (usually the gateway host)</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.1/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad::1/64&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># Last IP address (the broadcast address in IPv4 networks)</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;-1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.255/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad:ffff:ffff:ffff:ffff/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can also select IP addresses from a range by their index, from the start or
end of the range:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Returns from the start of the range</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;200&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.200/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad::c8/64&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># Returns from the end of the range</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;-200&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.168.32.56/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;2001:db8:32c:faad:ffff:ffff:ffff:ff38/64&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;400&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;2001:db8:32c:faad::190/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-information-from-host-prefix-values">
<h2><a class="toc-backref" href="#topics">Getting information from host/prefix values</a><a class="headerlink" href="#getting-information-from-host-prefix-values" title="Permalink to this headline">¶</a></h2>
<p>You frequently use a combination of IP addresses and subnet prefixes
(“CIDR”), this is even more common with IPv6. The <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter can extract
useful data from these prefixes.</p>
<p>Here’s an example set of two host prefixes (with some “control” values):</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">host_prefix = [&#39;2001:db8:deaf:be11::ef3/64&#39;, &#39;192.0.2.48/24&#39;, &#39;127.0.0.1&#39;, &#39;192.168.0.0/16&#39;]</span>
</pre></div>
</div>
<p>First, let’s make sure that we only work with correct host/prefix values, not
just subnets or single IP addresses:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">host_prefix</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;host/prefix&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;2001:db8:deaf:be11::ef3/64&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.0.2.48/24&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>In Debian-based systems, the network configuration stored in the <code class="docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> file uses a combination of IP address, network address, netmask and broadcast address to configure an IPv4 network interface. We can get these values from a single ‘host/prefix’ combination:</p>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x"># Jinja2 template</span>
<span class="cp">{%</span> <span class="k">set</span> <span class="nv">ipv4_host</span> <span class="o">=</span> <span class="nv">host_prefix</span> <span class="o">|</span> <span class="nf">unique</span> <span class="o">|</span> <span class="nf">ipv4</span><span class="o">(</span><span class="s1">&#39;host/prefix&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">first</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">iface eth0 inet static</span>
<span class="x">    address   </span><span class="cp">{{</span> <span class="nv">ipv4_host</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    network   </span><span class="cp">{{</span> <span class="nv">ipv4_host</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;network&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    netmask   </span><span class="cp">{{</span> <span class="nv">ipv4_host</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;netmask&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>
<span class="x">    broadcast </span><span class="cp">{{</span> <span class="nv">ipv4_host</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;broadcast&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x"></span>

<span class="x"># Generated configuration file</span>
<span class="x">iface eth0 inet static</span>
<span class="x">    address   192.0.2.48</span>
<span class="x">    network   192.0.2.0</span>
<span class="x">    netmask   255.255.255.0</span>
<span class="x">    broadcast 192.0.2.255</span>
</pre></div>
</div>
<p>In the above example, we needed to handle the fact that values were stored in
a list, which is unusual in IPv4 networks, where only a single IP address can be
set on an interface. However, IPv6 networks can have multiple IP addresses set
on an interface:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">.. code-block:</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jinja</span>

  <span class="l l-Scalar l-Scalar-Plain"># Jinja2 template</span>
  <span class="l l-Scalar l-Scalar-Plain">iface eth0 inet6 static</span>
    <span class="cp">{%</span> <span class="k">set</span> <span class="nv">ipv6_list</span> <span class="o">=</span> <span class="nv">host_prefix</span> <span class="o">|</span> <span class="nf">unique</span> <span class="o">|</span> <span class="nf">ipv6</span><span class="o">(</span><span class="s1">&#39;host/prefix&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="l l-Scalar l-Scalar-Plain">address</span> <span class="cp">{{</span> <span class="nv">ipv6_list</span><span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">ipv6_list</span> <span class="o">|</span> <span class="nf">length</span> <span class="o">&gt;</span> <span class="m">1</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">subnet</span> <span class="k">in</span> <span class="nv">ipv6_list</span><span class="o">[</span><span class="m">1</span><span class="o">:]</span> <span class="cp">%}</span>
    <span class="l l-Scalar l-Scalar-Plain">up   /sbin/ip address add </span><span class="cp">{{</span> <span class="nv">subnet</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain"> dev eth0</span>
    <span class="l l-Scalar l-Scalar-Plain">down /sbin/ip address del </span><span class="cp">{{</span> <span class="nv">subnet</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain"> dev eth0</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

  <span class="l l-Scalar l-Scalar-Plain"># Generated configuration file</span>
  <span class="l l-Scalar l-Scalar-Plain">iface eth0 inet6 static</span>
    <span class="l l-Scalar l-Scalar-Plain">address 2001:db8:deaf:be11::ef3/64</span>
</pre></div>
</div>
<p>If needed, you can extract subnet and prefix information from the ‘host/prefix’ value:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">host_prefix</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;host/prefix&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;subnet&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;2001:db8:deaf:be11::/64&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.0.2.0/24&#39;</span><span class="p p-Indicator">]</span>

<span class="c1"># </span><span class="cp">{{</span> <span class="nv">host_prefix</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;host/prefix&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;prefix&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="nv">64</span><span class="p p-Indicator">,</span> <span class="nv">24</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<div class="section" id="converting-subnet-masks-to-cidr-notation">
<h2><a class="toc-backref" href="#topics">Converting subnet masks to CIDR notation</a><a class="headerlink" href="#converting-subnet-masks-to-cidr-notation" title="Permalink to this headline">¶</a></h2>
<p>Given a subnet in the form of network address and subnet mask, the <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter can convert it into CIDR notation.  This can be useful for converting Ansible facts gathered about network configuration from subnet masks into CIDR format:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_default_ipv4</span><span class="p">:</span> <span class="p p-Indicator">{</span>
<span class="nt">    address</span><span class="p">:</span> <span class="s">&quot;192.168.0.11&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    alias</span><span class="p">:</span> <span class="s">&quot;eth0&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    broadcast</span><span class="p">:</span> <span class="s">&quot;192.168.0.255&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    gateway</span><span class="p">:</span> <span class="s">&quot;192.168.0.1&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    interface</span><span class="p">:</span> <span class="s">&quot;eth0&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    macaddress</span><span class="p">:</span> <span class="s">&quot;fa:16:3e:c4:bd:89&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    mtu</span><span class="p">:</span> <span class="nv">1500</span><span class="p p-Indicator">,</span>
<span class="nt">    netmask</span><span class="p">:</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    network</span><span class="p">:</span> <span class="s">&quot;192.168.0.0&quot;</span><span class="p p-Indicator">,</span>
<span class="nt">    type</span><span class="p">:</span> <span class="s">&quot;ether&quot;</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>First concatenate the network and netmask:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">net_mask = &quot;</span><span class="cp">{{</span> <span class="nv">ansible_default_ipv4.network</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="cp">{{</span> <span class="nv">ansible_default_ipv4.netmask</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;192.168.0.0/255.255.255.0&#39;</span>
</pre></div>
</div>
<p>This result can be converted to canonical form with <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> to produce a subnet in CIDR format:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">net_mask</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;prefix&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="s">&#39;24&#39;</span>

<span class="c1"># </span><span class="cp">{{</span> <span class="nv">net_mask</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;net&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="s">&#39;192.168.0.0/24&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-information-about-the-network-in-cidr-notation">
<h2><a class="toc-backref" href="#topics">Getting information about the network in CIDR notation</a><a class="headerlink" href="#getting-information-about-the-network-in-cidr-notation" title="Permalink to this headline">¶</a></h2>
<p>Given an IP address, the <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter can produce the network address in CIDR notation.
This can be useful when you want to obtain the network address from the IP address in CIDR format.</p>
<p>Here’s an example of IP address:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">ip_address = &quot;</span><span class="cp">{{</span> <span class="nv">ansible_default_ipv4.address</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="cp">{{</span> <span class="nv">ansible_default_ipv4.netmask</span> <span class="cp">}}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&#39;192.168.0.11/255.255.255.0&#39;</span>
</pre></div>
</div>
<p>This can be used to obtain the network address in CIDR notation format:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">ip_address</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;network/prefix&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="s">&#39;192.168.0.0/24&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="ip-address-conversion">
<h2><a class="toc-backref" href="#topics">IP address conversion</a><a class="headerlink" href="#ip-address-conversion" title="Permalink to this headline">¶</a></h2>
<p>Here’s our test list again:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example list of values</span>
<span class="l l-Scalar l-Scalar-Plain">test_list = [&#39;192.24.2.1&#39;, &#39;host.fqdn&#39;, &#39;::1&#39;, &#39;192.168.32.0/24&#39;, &#39;fe80::100/10&#39;, True, &#39;&#39;, &#39;42540766412265424405338506004571095040/64&#39;]</span>
</pre></div>
</div>
<p>You can convert IPv4 addresses into IPv6 addresses:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv4</span><span class="o">(</span><span class="s1">&#39;ipv6&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;::ffff:192.24.2.1/128&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;::ffff:192.168.32.0/120&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Converting from IPv6 to IPv4 works very rarely:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipv6</span><span class="o">(</span><span class="s1">&#39;ipv4&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;0.0.0.1/32&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>But we can make a double conversion if needed:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;ipv6&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;ipv4&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="s">&#39;192.24.2.1/32&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;0.0.0.1/32&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;192.168.32.0/24&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can convert IP addresses to integers, the same way that you can convert
integers into IP addresses:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;address&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;int&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="p p-Indicator">[</span><span class="nv">3222798849</span><span class="p p-Indicator">,</span> <span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;3232243712/24&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;338288524927261089654018896841347694848/10&#39;</span><span class="p p-Indicator">,</span> <span class="s">&#39;42540766412265424405338506004571095040/64&#39;</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>You can convert IPv4 address to <a class="reference external" href="https://en.wikipedia.org/wiki/Hexadecimal">Hexadecimal notation</a> with optional delimiter:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.1.5&#39;</span> <span class="o">|</span> <span class="nf">ip4_hex</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">c0a80105</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.1.5&#39;</span> <span class="o">|</span> <span class="nf">ip4_hex</span><span class="o">(</span><span class="s1">&#39;:&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">c0:a8:01:05</span>
</pre></div>
</div>
<p>You can convert IP addresses to PTR records:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">address</span> <span class="k">in</span> <span class="nv">test_list</span> <span class="o">|</span> <span class="nf">ipaddr</span> <span class="cp">%}</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;revdns&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># </span><span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="l l-Scalar l-Scalar-Plain">1.2.24.192.in-addr.arpa.</span>
<span class="l l-Scalar l-Scalar-Plain">1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa.</span>
<span class="l l-Scalar l-Scalar-Plain">0.32.168.192.in-addr.arpa.</span>
<span class="l l-Scalar l-Scalar-Plain">0.0.1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8.e.f.ip6.arpa.</span>
<span class="l l-Scalar l-Scalar-Plain">0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.d.a.a.f.c.2.3.0.8.b.d.0.1.0.0.2.ip6.arpa.</span>
</pre></div>
</div>
</div>
<div class="section" id="converting-ipv4-address-to-a-6to4-address">
<h2><a class="toc-backref" href="#topics">Converting IPv4 address to a 6to4 address</a><a class="headerlink" href="#converting-ipv4-address-to-a-6to4-address" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/6to4">6to4</a> tunnel is a way to access the IPv6 Internet from an IPv4-only network. If you
have a public IPv4 address, you can automatically configure its IPv6
equivalent in the <code class="docutils literal notranslate"><span class="pre">2002::/16</span></code> network range. After conversion you will gain
access to a <code class="docutils literal notranslate"><span class="pre">2002:xxxx:xxxx::/48</span></code> subnet which could be split into 65535
<code class="docutils literal notranslate"><span class="pre">/64</span></code> subnets if needed.</p>
<p>To convert your IPv4 address, just send it through the <code class="docutils literal notranslate"><span class="pre">'6to4'</span></code> filter. It will
be automatically converted to a router address (with a <code class="docutils literal notranslate"><span class="pre">::1/48</span></code> host address):</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;193.0.2.0&#39;</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;6to4&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">2002:c100:0200::1/48</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-ip-addresses-within-a-range">
<h2><a class="toc-backref" href="#topics">Finding IP addresses within a range</a><a class="headerlink" href="#finding-ip-addresses-within-a-range" title="Permalink to this headline">¶</a></h2>
<p>To find usable IP addresses within an IP range, try these <code class="docutils literal notranslate"><span class="pre">ipaddr</span></code> filters:</p>
<p>To find the next usable IP address in a range, use <code class="docutils literal notranslate"><span class="pre">next_usable</span></code></p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.122.1/24&#39;</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;next_usable&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.122.2</span>
</pre></div>
</div>
<p>To find the last usable IP address from a range, use <code class="docutils literal notranslate"><span class="pre">last_usable</span></code>:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.122.1/24&#39;</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;last_usable&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.122.254</span>
</pre></div>
</div>
<p>To find the available range of IP addresses from the given network address, use <code class="docutils literal notranslate"><span class="pre">range_usable</span></code>:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.122.1/24&#39;</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;range_usable&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.122.1-192.168.122.254</span>
</pre></div>
</div>
<p>To find the next nth usable IP address within a range, use <code class="docutils literal notranslate"><span class="pre">next_nth_usable</span></code>:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.122.1/24&#39;</span> <span class="o">|</span> <span class="nf">next_nth_usable</span><span class="o">(</span><span class="m">2</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.122.3</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">next_nth_usable</span></code> returns the second usable IP address for the given IP range.</p>
</div>
<div class="section" id="ip-math">
<h2><a class="toc-backref" href="#topics">IP Math</a><a class="headerlink" href="#ip-math" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.7.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ipmath()</span></code> filter can be used to do simple IP math/arithmetic.</p>
<p>Here are a few simple examples:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;192.168.1.5&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.1.10</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.0.5&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(-</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.167.255.251</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.1.1/24&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.1.6</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.1.6/24&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(-</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.2.6/24&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(-</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.1.252</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;2001::1&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">2001::b</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;2001::5&#39;</span> <span class="o">|</span> <span class="nf">ipmath</span><span class="o">(-</span><span class="m">10</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">2000:ffff:ffff:ffff:ffff:ffff:ffff:fffb</span>
</pre></div>
</div>
</div>
<div class="section" id="subnet-manipulation">
<h2><a class="toc-backref" href="#topics">Subnet manipulation</a><a class="headerlink" href="#subnet-manipulation" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter can be used to manipulate network subnets in several ways.</p>
<p>Here is an example IP address and subnet:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">address = &#39;192.168.144.5&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">subnet  = &#39;192.168.0.0/16&#39;</span>
</pre></div>
</div>
<p>To check if a given string is a subnet, pass it through the filter without any
arguments. If the given string is an IP address, it will be converted into
a subnet:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.144.5/32</span>

<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.0.0/16</span>
</pre></div>
</div>
<p>If you specify a subnet size as the first parameter of the  <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter, and
the subnet size is <strong>smaller than the current one</strong>, you will get the number of subnets
a given subnet can be split into:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">16</span>
</pre></div>
</div>
<p>The second argument of the <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter is an index number; by specifying it
you can get a new subnet with the specified size:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># First subnet</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">,</span> <span class="m">0</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.0.0/20</span>

<span class="l l-Scalar l-Scalar-Plain"># Last subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">,</span> <span class="o">-</span><span class="m">1</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.240.0/20</span>

<span class="l l-Scalar l-Scalar-Plain"># Fifth subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">,</span> <span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.80.0/20</span>

<span class="l l-Scalar l-Scalar-Plain"># Fifth to last subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">subnet</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">,</span> <span class="o">-</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.176.0/20</span>
</pre></div>
</div>
<p>If you specify an IP address instead of a subnet, and give a subnet size as
the first argument, the <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter will instead return the biggest subnet that
contains that given IP address:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">20</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.144.0/20</span>
</pre></div>
</div>
<p>By specifying an index number as a second argument, you can select smaller and
smaller subnets:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># First subnet</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">18</span><span class="o">,</span> <span class="m">0</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.128.0/18</span>

<span class="l l-Scalar l-Scalar-Plain"># Last subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">18</span><span class="o">,</span> <span class="o">-</span><span class="m">1</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.144.4/31</span>

<span class="l l-Scalar l-Scalar-Plain"># Fifth subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">18</span><span class="o">,</span> <span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.144.0/23</span>

<span class="l l-Scalar l-Scalar-Plain"># Fifth to last subnet</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">18</span><span class="o">,</span> <span class="o">-</span><span class="m">5</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">192.168.144.0/27</span>
</pre></div>
</div>
<p>By specifying another subnet as a second argument, if the second subnet includes
the first, you can determine the rank of the first subnet in the second</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># The rank of the IP in the subnet (the IP is the 36870nth /32 of the subnet)</span>
<span class="c1"># </span><span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="nv">subnet</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">36870</span>

<span class="l l-Scalar l-Scalar-Plain"># The rank in the /24 that contain the address</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">address</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="s1">&#39;192.168.144.0/24&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">6</span>

<span class="l l-Scalar l-Scalar-Plain"># An IP with the subnet in the first /30 in a /24</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.144.1/30&#39;</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="s1">&#39;192.168.144.0/24&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="l l-Scalar l-Scalar-Plain"># The fifth subnet /30 in a /24</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="s1">&#39;192.168.144.16/30&#39;</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="s1">&#39;192.168.144.0/24&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
<p>If the second subnet doesn’t include the first subnet, the <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter raises an error.</p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">ipsubnet()</span></code> filter with the <code class="docutils literal notranslate"><span class="pre">ipaddr()</span></code> filter to, for example, split
a given <code class="docutils literal notranslate"><span class="pre">/48</span></code> prefix into smaller <code class="docutils literal notranslate"><span class="pre">/64</span></code> subnets:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># </span><span class="cp">{{</span> <span class="s1">&#39;193.0.2.0&#39;</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;6to4&#39;</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipsubnet</span><span class="o">(</span><span class="m">64</span><span class="o">,</span> <span class="m">58820</span><span class="o">)</span> <span class="o">|</span> <span class="nf">ipaddr</span><span class="o">(</span><span class="s1">&#39;1&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">2002:c100:200:e5c4::1/64</span>
</pre></div>
</div>
<p>Because of the size of IPv6 subnets, iteration over all of them to find the
correct one may take some time on slower computers, depending on the size
difference between the subnets.</p>
</div>
<div class="section" id="subnet-merging">
<h2><a class="toc-backref" href="#topics">Subnet Merging</a><a class="headerlink" href="#subnet-merging" title="Permalink to this headline">¶</a></h2>
<div class="versionadded">
<p><span class="versionmodified added">New in version 2.6.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cidr_merge()</span></code> filter can be used to merge subnets or individual addresses
into their minimal representation, collapsing overlapping subnets and merging
adjacent ones wherever possible:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;192.168.0.0/17&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.128.0/17&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.128.1&#39;</span> <span class="o">]</span> <span class="o">|</span> <span class="nf">cidr_merge</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;192.168.0.0/16&#39;]</span>

<span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;192.168.0.0/24&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.1.0/24&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.3.0/24&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">cidr_merge</span> <span class="cp">}}</span>
<span class="c1"># =&gt; [&#39;192.168.0.0/23&#39;, &#39;192.168.3.0/24&#39;]</span>
</pre></div>
</div>
<p>Changing the action from ‘merge’ to ‘span’ will instead return the smallest
subnet which contains all of the inputs:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;192.168.0.0/24&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.3.0/24&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">cidr_merge</span><span class="o">(</span><span class="s1">&#39;span&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;192.168.0.0/22&#39;</span>

<span class="cp">{{</span> <span class="o">[</span><span class="s1">&#39;192.168.1.42&#39;</span><span class="o">,</span> <span class="s1">&#39;192.168.42.1&#39;</span><span class="o">]</span> <span class="o">|</span> <span class="nf">cidr_merge</span><span class="o">(</span><span class="s1">&#39;span&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="c1"># =&gt; &#39;192.168.0.0/18&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="mac-address-filter">
<h2><a class="toc-backref" href="#topics">MAC address filter</a><a class="headerlink" href="#mac-address-filter" title="Permalink to this headline">¶</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">hwaddr()</span></code> filter to check if a given string is a MAC address or
convert it between various formats. Examples:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example MAC address</span>
<span class="l l-Scalar l-Scalar-Plain">macaddress = &#39;1a:2b:3c:4d:5e:6f&#39;</span>

<span class="l l-Scalar l-Scalar-Plain"># Check if given string is a MAC address</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">macaddress</span> <span class="o">|</span> <span class="nf">hwaddr</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">1a:2b:3c:4d:5e:6f</span>

<span class="l l-Scalar l-Scalar-Plain"># Convert MAC address to PostgreSQL format</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">macaddress</span> <span class="o">|</span> <span class="nf">hwaddr</span><span class="o">(</span><span class="s1">&#39;pgsql&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">1a2b3c:4d5e6f</span>

<span class="l l-Scalar l-Scalar-Plain"># Convert MAC address to Cisco format</span>
<span class="l l-Scalar l-Scalar-Plain">#</span> <span class="cp">{{</span> <span class="nv">macaddress</span> <span class="o">|</span> <span class="nf">hwaddr</span><span class="o">(</span><span class="s1">&#39;cisco&#39;</span><span class="o">)</span> <span class="cp">}}</span>
<span class="l l-Scalar l-Scalar-Plain">1a2b.3c4d.5e6f</span>
</pre></div>
</div>
<p>The supported formats result in the following conversions for the <code class="docutils literal notranslate"><span class="pre">1a:2b:3c:4d:5e:6f</span></code> MAC address:</p>
<div class="highlight-YAML+Jinja notranslate"><div class="highlight"><pre><span></span><span class="nt">bare</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1A2B3C4D5E6F</span>
<span class="nt">bool</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">int</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">28772997619311</span>
<span class="nt">cisco</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1a2b.3c4d.5e6f</span>
<span class="nt">eui48 or win</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1A-2B-3C-4D-5E-6F</span>
<span class="nt">linux or unix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1a:2b:3c:4d:5e:6f</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">pgsql, postgresql, or psql</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1a2b3c:4d5e6f</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="playbooks_intro.html#about-playbooks"><span class="std std-ref">About Playbooks</span></a></dt><dd><p>An introduction to playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_filters.html#playbooks-filters"><span class="std std-ref">Filters</span></a></dt><dd><p>Introduction to Jinja2 filters and their uses</p>
</dd>
<dt><a class="reference internal" href="playbooks_conditionals.html#playbooks-conditionals"><span class="std std-ref">Conditionals</span></a></dt><dd><p>Conditional statements in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_variables.html#playbooks-variables"><span class="std std-ref">Using Variables</span></a></dt><dd><p>All about variables</p>
</dd>
<dt><a class="reference internal" href="playbooks_loops.html#playbooks-loops"><span class="std std-ref">Loops</span></a></dt><dd><p>Looping in playbooks</p>
</dd>
<dt><a class="reference internal" href="playbooks_reuse_roles.html#playbooks-reuse-roles"><span class="std std-ref">Roles</span></a></dt><dd><p>Playbook organization by roles</p>
</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html#playbooks-best-practices"><span class="std std-ref">Best Practices</span></a></dt><dd><p>Best practices in playbooks</p>
</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-devel">User Mailing List</a></dt><dd><p>Have a question?  Stop by the google group!</p>
</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt><dd><p>#ansible IRC chat channel</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Red Hat, Inc.
      <span class="lastupdated">
        Last updated on Jul 02, 2020.
      </span>

    </p>
  </div> 
</footer>
        </div>
      </div>

    </section>

  </div>

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>

  
  
    
   <!-- extra footer elements for Ansible beyond RTD Sphinx Theme --->
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script> 

</body>
</html>